# Contributor: Benjamin Bukowski <benjamin.bukowski@googlemail.com>
pkgname=mplayer-svn
pkgver=36831
pkgrel=1
pkgdesc='A movie player for Linux'
arch=('i686' 'x86_64')
url='http://www.mplayerhq.hu/'
license=('GPL2')
depends=('ttf-font')
makedepends=('subversion' 'git' 'yasm')
provides=('mplayer' 'mencoder')
conflicts=('mplayer' 'mencoder')
backup=('etc/mplayer/mplayer.conf'
        'etc/mplayer/codecs.conf'
        'etc/mplayer/input.conf'
        'etc/mplayer/menu.conf'
        'etc/mplayer/dvb-menu.conf')
install="$pkgname.install"
source=("$pkgname::svn://svn.mplayerhq.hu/mplayer/trunk"
	'configure-copy-disabled-features.patch'
	'mplayer.conf')

md5sums=('SKIP'
         'db50b7f27969045172ed7d1eebca47cf'
         'd82577aa11f1077dea79ccdda27d0641')

pkgver(){
  cd "$startdir/$pkgname"
  svnversion | tr -d [A-z]
}

build(){
  cd "$srcdir/$pkgname"

  ## Applying some patches...
  #for patch in ../*.patch; do
  #  msg "Applying `basename $patch`..."
  #  patch -Np1 -i $patch
  #done

  # Add --enable-gui for a gui
  # Add --enable-joystick for a joystick
  ./configure --prefix=/usr --confdir=/etc/mplayer --language=all \
    --enable-relocatable --enable-ass-internal --disable-ffmpeg_so \
    --disable-smb --disable-vesa --disable-svga --disable-dga2 \
    --disable-dga1 --disable-sdl --disable-kva --disable-fbdev \
    --enable-gl --enable-xv --disable-directfb \
    --disable-aa --disable-caca --disable-vdpau \
    --disable-v4l2 --disable-dvb --disable-mga --disable-xmga \
    --disable-xvid --disable-xvid-lavc --disable-x264-lavc \
    --disable-sunaudio \
    --disable-vidix --disable-ossaudio  --disable-arts --disable-esd \
    --enable-pulse --disable-jack --disable-openal --disable-nas

  make 
}

package(){
  cd "$srcdir/$pkgname"

  make DESTDIR="$pkgdir" install

  install -Dm644 etc/{codecs.conf,dvb-menu.conf,example.conf,input.conf,menu.conf} "$pkgdir"/etc/mplayer
  install -dm755 "$pkgdir"/usr/share/mplayer
  install -m644 etc/mplayer{.desktop,.ico,{16x16,22x22,24x24,32x32,48x48,256x256}.png} "$pkgdir"/usr/share/mplayer
  install -m644 disabled_features "$pkgdir"/etc/mplayer
  install -m644 $srcdir/mplayer.conf "$pkgdir"/etc/mplayer
}

